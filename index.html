<!DOCTYPE html>
<html>
  <head>
    <title>Video player</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link href='https://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet'>
    <style>
      .menu {
        max-height: min(500px,60vh);
        overflow-y: auto;
      }
      section {
        background: rgb(147,158,158);
        background: linear-gradient(0deg, rgba(147,158,158,1) 0%, rgba(122,138,177,1) 100%);
      }
      li:hover {
        color: black;
      }
      a {
        font-family: 'Ubuntu';
      }
    </style>
  </head>
  <body>
    <section class="hero is-fullheight is-dark">
      <div class="hero-body">
        <div class="columns">
          <div class="column is-6">
            <div id="video-player-container">
              <video id="video-player" controls>
              <source src="" />
              </video>
            </div>
          </div>
          <div class="column is-6">
            <aside class="menu">
              <ul id="playlist" class="menu-list"></ul>
            </aside>
          </div>
        </div>
      </div>
    </section>
    <script>
      // JavaScript for the video player and playlist
      const videoPlayer = document.getElementById("video-player");
      const playlistContainer = document.getElementById("playlist");
      let currentPlaylistItem = null;

      // Fetch playlist data from endpoint
      fetch("/api/playlist")
        .then((response) => response.json())
        .then((data) => {
          // Loop through playlist data and create playlist items
          data.forEach((item) => {
            const playlistAnchor = document.createElement("a");
            const playlistItem = document.createElement("li");
            playlistAnchor.textContent = item.title;
            playlistItem.appendChild(playlistAnchor);

            playlistItem.setAttribute("data-src", item.video_url);
            playlistContainer.appendChild(playlistItem);

            // Add click event listener to playlist item
            playlistAnchor.addEventListener("click", () => {
              const src = playlistItem.getAttribute("data-src");
              setCurrentPlaylistItem(playlistItem);
              playVideo(src);
            });
          });
          // Start playing the first video in the playlist
          if (data.length > 0) {
            setCurrentPlaylistItem(playlistContainer.firstElementChild);
            playVideo(playlistContainer.firstElementChild.getAttribute("data-src"));
          }
        })
        .catch((error) => console.error(error));

      function setCurrentPlaylistItem(playlistItem) {
        // Remove "current" class from previous playlist item
        if (currentPlaylistItem) {
          currentPlaylistItem.firstElementChild.classList.remove("is-active");
        }
        // Add "current" class to new playlist item
        currentPlaylistItem = playlistItem;
        currentPlaylistItem.firstElementChild.classList.add("is-active");
      }

      function playVideo(src) {
        videoPlayer.src = src;
        videoPlayer.play();
      }

      // Automatically play the next video when the current video ends
      videoPlayer.addEventListener("ended", () => {
        if (currentPlaylistItem.nextElementSibling) {
          // Play the next video in the playlist
          const src = currentPlaylistItem.nextElementSibling.getAttribute("data-src");
          setCurrentPlaylistItem(currentPlaylistItem.nextElementSibling);
          playVideo(src);
        } else {
          // Reached the end of the playlist
          setCurrentPlaylistItem(null);
          videoPlayer.pause();
        }
      });
    </script>
  </body>
</html>
